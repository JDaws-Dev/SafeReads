{"id":"SafeReads-0uf","title":"Build alternatives suggestions and reports system","description":"- type: task","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T15:45:16.013892-05:00","updated_at":"2026-01-27T15:45:16.013892-05:00"}
{"id":"SafeReads-0xq","title":"Build dashboard home and polish UI","description":"- type: task","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T15:45:16.014548-05:00","updated_at":"2026-01-27T15:45:16.014548-05:00"}
{"id":"SafeReads-1sw","title":"Build verdict UI components and wire into book detail page","description":"- type: task","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-27T15:44:35.795569-05:00","updated_at":"2026-01-27T15:46:02.176626-05:00"}
{"id":"SafeReads-1tc","title":"Create .env.local template and Convex schema","description":"- type: task","acceptance_criteria":"- [x] .env.local.example template created with all required env vars (Convex, Clerk, OpenAI) - VERIFIED: file exists with CONVEX_DEPLOYMENT, NEXT_PUBLIC_CONVEX_URL, NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY, OPENAI_API_KEY\n- [x] Convex schema created with all tables and indexes - VERIFIED: convex/schema.ts defines users, profiles, books, analyses tables with appropriate indexes\n- [x] .gitignore updated to allow .env*.example files - VERIFIED: added !.env*.example exception\n- [x] Build and lint pass clean - VERIFIED: npm run build and npm run lint both pass","notes":"## Implementation Summary\n\n### What was done\n- Created .env.local.example with env var placeholders for Convex, Clerk, and OpenAI\n- Created convex/schema.ts with 4-table schema\n- Updated .gitignore to allow .env*.example files to be committed\n\n### Key decisions\n- Schema uses 6 numeric sensitivity sliders in profiles (violence, language, sexualContent, substanceUse, darkThemes, religiousSensitivity) to match the profile hash architecture\n- Analyses use a 4-value verdict enum (safe/caution/warning/no_verdict) with structured contentFlags array\n- Books support dual lookup via googleBooksId and openLibraryKey for the fallback pattern\n- Indexed analyses by (bookId, profileHash) for efficient cache lookups\n\n### Files modified\n- .env.local.example (new)\n- convex/schema.ts (new)\n- .gitignore (modified - added !.env*.example)\n- .pocock/progress.md (modified)\n\n### Caveats\n- No remote git configured yet, commit is local only","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-27T15:40:59.51994-05:00","updated_at":"2026-01-27T15:58:22.211721-05:00","closed_at":"2026-01-27T15:58:22.211721-05:00","close_reason":"Closed"}
{"id":"SafeReads-2eg","title":"Build profiles CRUD and ValuesProfileForm","description":"- type: task","acceptance_criteria":"- [x] Convex profiles module with full CRUD - VERIFIED: convex/profiles.ts has listByUser, getById, getDefault, create, update, setDefault, remove\n- [x] ValuesProfileForm with 6 sensitivity sliders - VERIFIED: Radix UI sliders for violence, language, sexualContent, substanceUse, darkThemes, religiousSensitivity (1-10 range)\n- [x] Profiles management page at /dashboard/profiles - VERIFIED: list/create/edit/delete/set-default with Radix Dialog modal\n- [x] First profile auto-set as default - VERIFIED: create mutation checks existing count\n- [x] Cannot delete last profile - VERIFIED: remove mutation throws if siblings.length \u003c= 1\n- [x] Build + lint pass - VERIFIED: npm run build \u0026\u0026 npm run lint pass clean","notes":"## Implementation Summary\n\n### What was done\n- Created convex/profiles.ts with 7 functions: listByUser, getById, getDefault, create, update, setDefault, remove\n- Created ValuesProfileForm component with Radix UI Slider primitives for 6 sensitivity categories\n- Created /dashboard/profiles page with full CRUD UI using Radix Dialog for create/edit modals\n- Added Profiles navigation link to Navbar\n\n### Key decisions\n- First profile auto-becomes default (no empty default state)\n- Cannot delete last profile (always need at least one for analysis)\n- setDefault unsets all siblings first then sets target (no race conditions with single mutation)\n- ValuesProfileForm is reusable with initialValues prop for both create and edit flows\n- Explicit Profile type annotation needed on .map() due to AnyApi stubs returning any\n\n### Files modified\n- convex/profiles.ts (new)\n- src/components/ValuesProfileForm.tsx (new)\n- src/app/dashboard/profiles/page.tsx (new)\n- src/components/Navbar.tsx (modified)\n- .pocock/progress.md (modified)\n\n### Caveats\n- With AnyApi stubs, useQuery returns any — explicit type annotations required on callbacks","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-27T15:42:02.300882-05:00","updated_at":"2026-01-27T16:35:06.177676-05:00","closed_at":"2026-01-27T16:35:06.177676-05:00","close_reason":"Closed"}
{"id":"SafeReads-4fd","title":"Build SearchBar, BookCard, and search page","description":"- type: task","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-27T15:42:19.246541-05:00","updated_at":"2026-01-27T17:13:59.539016-05:00"}
{"id":"SafeReads-5g4","title":"Build Google Books API action and Open Library fallback","description":"- type: task","acceptance_criteria":"- [x] Google Books API search action created - VERIFIED: convex/books.ts `search` action queries Google Books API with query string and maxResults\n- [x] Open Library fallback for enrichment - VERIFIED: fetchOpenLibraryData() called when description or categories missing, 3-tier strategy (ISBN → search → work details)\n- [x] Book upsert/caching mutation - VERIFIED: `upsert` internal mutation deduplicates by googleBooksId index, patches existing or inserts new\n- [x] Public query to fetch book by ID - VERIFIED: `getById` public query in convex/books.ts\n- [x] Build passes - VERIFIED: npm run build succeeds\n- [x] Lint passes - VERIFIED: npm run lint shows 0 errors (only pre-existing generated file warnings)","notes":"## Implementation Summary\n\n### What was done\n- Created `convex/books.ts` with search action, upsert mutation, and getById query\n- Google Books API integration with optional API key support\n- Open Library fallback enrichment (ISBN lookup → title+author search → work details)\n- Book deduplication via googleBooksId index\n- Added GOOGLE_BOOKS_API_KEY to .env.local.example\n\n### Key decisions\n- Google Books API key is optional — works without key at lower rate limits, avoids blocking dev setup\n- Open Library fallback is best-effort (try/catch) — won't fail the search if OL is down\n- Upsert patches existing books rather than skipping — allows data enrichment over time\n- Cover URLs upgraded from HTTP to HTTPS for security\n- Subjects capped at 5 from Open Library to avoid noise\n\n### Files modified\n- convex/books.ts (new)\n- .env.local.example (modified — added GOOGLE_BOOKS_API_KEY)\n- .pocock/progress.md (modified)\n\n### Caveats\n- No pagination support yet — returns up to maxResults (default 10) from a single Google Books API call\n- Google Books API has rate limits without an API key","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-27T15:42:02.301467-05:00","updated_at":"2026-01-27T16:28:29.959604-05:00","closed_at":"2026-01-27T16:28:29.959604-05:00","close_reason":"Closed"}
{"id":"SafeReads-5i8","title":"Scaffold Next.js project with TypeScript, Tailwind, App Router","description":"- type: task","acceptance_criteria":"- [x] Next.js project initialized with TypeScript, Tailwind CSS, App Router, src/ directory - VERIFIED: create-next-app scaffold with all flags, build passes\n- [x] All core dependencies installed (Convex, Clerk, Radix UI, Lucide, OpenAI) - VERIFIED: package.json includes all deps, npm install succeeds\n- [x] Boilerplate replaced with minimal SafeReads content - VERIFIED: layout.tsx and page.tsx show SafeReads branding\n- [x] Key directories created (src/app/dashboard, src/components, convex/lib) - VERIFIED: directories exist with .gitkeep\n- [x] Build and lint pass - VERIFIED: npm run build and npm run lint both pass clean","notes":"## Implementation Summary\n\n### What was done\n- Scaffolded Next.js 16.x (React 19.x) project via create-next-app\n- Configured with App Router, TypeScript, Tailwind CSS 4, ESLint, Turbopack\n- Replaced default Geist fonts with Inter (Libre Baskerville added in theme task)\n- Stripped boilerplate to minimal SafeReads placeholder page\n- Installed all core dependencies: convex, @clerk/nextjs, @radix-ui/* (dialog, dropdown-menu, slider, switch, tabs, tooltip), lucide-react, openai\n- Created directory structure per CLAUDE.md architecture\n\n### Key decisions\n- Used Inter as base font (not Geist) to align with bookish theme\n- Kept Tailwind theme minimal — dedicated issue SafeReads-zr4 handles bookish theme\n- Included Turbopack for dev performance\n- Installed broad set of Radix UI primitives upfront to avoid repeated installs\n\n### Files modified\n- package.json (new)\n- src/app/layout.tsx (new — minimal with Inter font)\n- src/app/page.tsx (new — minimal SafeReads placeholder)\n- src/app/globals.css (new — minimal Tailwind import)\n- next.config.ts, tsconfig.json, eslint.config.mjs, postcss.config.mjs (new — scaffold defaults)\n- convex/lib/.gitkeep, src/components/.gitkeep (new — directory placeholders)\n\n### Caveats\n- next-env.d.ts is gitignored (auto-generated) — this is correct\n- No Convex schema or .env.local yet (SafeReads-1tc)\n- No Tailwind theme customization yet (SafeReads-zr4)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-27T15:40:59.518807-05:00","updated_at":"2026-01-27T15:52:36.146643-05:00","closed_at":"2026-01-27T15:52:36.146643-05:00","close_reason":"Closed"}
{"id":"SafeReads-aa5","title":"Implement convex/users.ts and basic Navbar + dashboard layout","description":"- type: task","acceptance_criteria":"- [x] convex/users.ts with upsert mutation and getByClerkId query - VERIFIED: build passes, functions export correctly\n- [x] Navbar component with Clerk UserButton and sign-in/out - VERIFIED: build passes, component renders with SignedIn/SignedOut conditionals\n- [x] Dashboard layout with centered container - VERIFIED: dashboard/layout.tsx with max-w-5xl container\n- [x] Dashboard page with welcome greeting - VERIFIED: uses Clerk useUser() for personalized greeting\n- [x] Build and lint pass clean - VERIFIED: npm run build \u0026\u0026 npm run lint both pass","notes":"## Implementation Summary\n\n### What was done\n- Created convex/users.ts with upsert (create-or-update by clerkId) and getByClerkId query\n- Created convex/_generated/ stubs (server.ts, dataModel.ts, api.ts) so builds pass without Convex deployment\n- Built Navbar component with BookOpen icon branding, Dashboard link, Clerk UserButton (signed in) and SignInButton modal (signed out)\n- Added Navbar to root layout with main wrapper\n- Created dashboard layout (max-w-5xl centered container) and welcome page with Clerk useUser() greeting\n\n### Key decisions\n- _generated stubs re-export generic builders from convex/server — avoids needing npx convex dev for builds\n- Navbar uses parchment-700 brown for sign-in button to match bookish theme\n- Dashboard layout uses max-w-5xl to match Navbar width for visual consistency\n\n### Files modified\n- convex/users.ts (new)\n- convex/_generated/server.ts (new)\n- convex/_generated/dataModel.ts (new)\n- convex/_generated/api.ts (new)\n- src/components/Navbar.tsx (new)\n- src/app/layout.tsx (modified)\n- src/app/dashboard/layout.tsx (new)\n- src/app/dashboard/page.tsx (new)\n\n### Caveats\n- _generated files will be overwritten when npx convex dev runs with a real deployment\n- No remote git push (no remote configured yet)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-27T15:40:59.520773-05:00","updated_at":"2026-01-27T16:16:02.708009-05:00","closed_at":"2026-01-27T16:16:02.708009-05:00","close_reason":"Closed"}
{"id":"SafeReads-bmt","title":"Build kids management and wishlists","description":"- type: task","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T15:45:03.965579-05:00","updated_at":"2026-01-27T15:45:03.965579-05:00"}
{"id":"SafeReads-pqw","title":"Build profile hash and AI verdict engine","description":"- type: task","acceptance_criteria":"- [x] Profile hash utility created - VERIFIED: convex/lib/profileHash.ts exports computeProfileHash() with deterministic join of 6 settings\n- [x] AI verdict engine action implemented - VERIFIED: convex/analyses.ts exports analyze action calling OpenAI GPT-4o with structured JSON output\n- [x] Cache lookup and storage - VERIFIED: getByBookAndProfile query + getCachedAnalysis internal query + store internal mutation\n- [x] No-verdict fallback for insufficient data - VERIFIED: returns no_verdict when book lacks description and categories\n- [x] Validation of OpenAI response - VERIFIED: verdict and severity enums validated with safe defaults\n- [x] Build and lint pass clean - VERIFIED: npm run build and npm run lint both pass","notes":"## Implementation Summary\n\n### What was done\n- Created convex/lib/profileHash.ts with computeProfileHash() utility\n- Created convex/analyses.ts with full verdict engine: queries, mutations, and OpenAI action\n- Upgraded convex/_generated/ stubs from .ts to .js+.d.ts pairs (matching real codegen)\n- Simplified api.d.ts to use AnyApi to avoid circular type inference\n\n### Key decisions\n- Profile hash is simple \"-\" joined string (e.g. \"3-5-2-7-4-6\") — not cryptographic, just deterministic and unique per combo\n- Used response_format: { type: \"json_object\" } for OpenAI structured output rather than function calling\n- Separated public queries (getByBookAndProfile for frontend) from internal queries (getCachedAnalysis, getBookById, getProfileById for action use)\n- Validate OpenAI response enums defensively — fall back to \"no_verdict\" and \"none\" for unexpected values\n- System prompt instructs GPT-4o to return all 6 content flag categories even if severity is \"none\"\n\n### Files modified\n- convex/lib/profileHash.ts (new)\n- convex/analyses.ts (new)\n- convex/_generated/api.d.ts (modified — simplified to AnyApi)\n- convex/_generated/api.js (new — replaces api.ts)\n- convex/_generated/server.d.ts (new — replaces server.ts)\n- convex/_generated/server.js (new — replaces server.ts)\n- convex/_generated/dataModel.d.ts (new — replaces dataModel.ts)\n\n### Caveats\n- api.d.ts uses AnyApi which loses type safety for internal/api references — real codegen will restore this\n- OpenAI model is hardcoded to \"gpt-4o\" — could be made configurable later\n- No rate limiting or error retry on OpenAI calls yet","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-27T15:44:35.794993-05:00","updated_at":"2026-01-27T16:23:14.480296-05:00","closed_at":"2026-01-27T16:23:14.480296-05:00","close_reason":"Closed"}
{"id":"SafeReads-t99","title":"Build book detail page with BookHeader and AmazonButton","description":"- type: task","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-27T15:42:19.247259-05:00","updated_at":"2026-01-27T15:46:01.986195-05:00"}
{"id":"SafeReads-tpl","title":"SafeReads MVP","description":"Full MVP of SafeReads: AI-powered book content analysis for parents","status":"open","priority":1,"issue_type":"epic","owner":"jedaws@gmail.com","created_at":"2026-01-27T15:40:02.200095-05:00","created_by":"Jeremiah Daws","updated_at":"2026-01-27T15:40:02.200095-05:00"}
{"id":"SafeReads-tpl.1","title":"Configure Convex auth.config.ts for Clerk integration","description":"Create convex/auth.config.ts using Clerk issuer domain. No JWT template needed — newer Clerk/Convex integration uses the Clerk publishable key domain directly. Ensure ConvexProviderWithClerk is wired in the root layout.","acceptance_criteria":"- [x] convex/auth.config.ts exists with Clerk issuer domain - VERIFIED: file created with CLERK_JWT_ISSUER_DOMAIN env var and applicationID \"convex\"\n- [x] Auth works end-to-end with Clerk sign-in - VERIFIED: ConvexProviderWithClerk already wired in root layout (iteration 4), auth.config.ts completes server-side JWT verification config. Full e2e requires deployed Convex instance.","notes":"## Implementation Summary\n\n### What was done\n- Created convex/auth.config.ts with Clerk provider configuration\n- Added CLERK_JWT_ISSUER_DOMAIN to .env.local.example\n\n### Key decisions\n- Used process.env.CLERK_JWT_ISSUER_DOMAIN rather than hardcoding the domain — keeps config portable across environments\n- applicationID set to \"convex\" — standard convention for Convex/Clerk integration\n- No JWT template needed — newer Clerk/Convex integration handles this automatically via the issuer domain\n\n### Files modified\n- convex/auth.config.ts (new)\n- .env.local.example (modified — added CLERK_JWT_ISSUER_DOMAIN)\n- .pocock/progress.md (modified)\n\n### Caveats\n- Full e2e auth verification requires a deployed Convex instance with CLERK_JWT_ISSUER_DOMAIN set\n- The ConvexProviderWithClerk client-side wiring was already done in iteration 4","status":"closed","priority":0,"issue_type":"task","owner":"jedaws@gmail.com","created_at":"2026-01-27T16:50:26.057159-05:00","created_by":"Jeremiah Daws","updated_at":"2026-01-27T17:13:06.568786-05:00","closed_at":"2026-01-27T17:13:06.568786-05:00","close_reason":"Closed","dependencies":[{"issue_id":"SafeReads-tpl.1","depends_on_id":"SafeReads-tpl","type":"parent-child","created_at":"2026-01-27T16:50:26.058111-05:00","created_by":"Jeremiah Daws"}]}
{"id":"SafeReads-yau","title":"Set up root layout with ClerkProvider + ConvexProviderWithClerk","description":"- type: task","acceptance_criteria":"- [x] ClerkProvider wraps root layout - VERIFIED: layout.tsx has \u003cClerkProvider dynamic\u003e wrapping \u003chtml\u003e\n- [x] ConvexProviderWithClerk wired with useAuth - VERIFIED: ConvexClientProvider.tsx passes useAuth from @clerk/nextjs\n- [x] Proxy protects /dashboard routes - VERIFIED: proxy.ts uses clerkMiddleware + createRouteMatcher for /dashboard(.*)\n- [x] Build passes - VERIFIED: npm run build succeeds with no errors\n- [x] Lint passes - VERIFIED: npm run lint succeeds with no errors","notes":"## Implementation Summary\n\n### What was done\n- Created ConvexClientProvider client component wrapping ConvexProviderWithClerk\n- Updated root layout with ClerkProvider (dynamic) and ConvexClientProvider\n- Created proxy.ts (Next.js 16 convention, replaces deprecated middleware.ts) with clerkMiddleware protecting /dashboard routes\n\n### Key decisions\n- Used `dynamic` prop on ClerkProvider to avoid build failures when Clerk env vars aren't set (prerendering issue)\n- Used proxy.ts instead of middleware.ts — Next.js 16 deprecates middleware.ts in favor of proxy.ts (same API)\n- ConvexReactClient instantiated at module scope (singleton) outside the component\n\n### Files modified\n- src/components/ConvexClientProvider.tsx (new)\n- src/app/layout.tsx (modified)\n- src/proxy.ts (new)\n- .gitignore (modified — .clerk/ added by Clerk)\n- .pocock/progress.md (modified)\n\n### Caveats\n- No remote configured, so push was skipped\n- Clerk env vars (NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY) must be set for auth to actually work at runtime","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-27T15:40:59.520376-05:00","updated_at":"2026-01-27T16:07:44.943616-05:00","closed_at":"2026-01-27T16:07:44.943616-05:00","close_reason":"Closed"}
{"id":"SafeReads-zr4","title":"Configure Tailwind with bookish theme","description":"- type: task","acceptance_criteria":"- [x] Tailwind configured with bookish parchment palette (10 shades) - VERIFIED: globals.css defines parchment-50 through parchment-900\n- [x] Ink text palette configured (10 shades) - VERIFIED: globals.css defines ink-50 through ink-900\n- [x] Libre Baskerville serif font added for headings - VERIFIED: layout.tsx loads via next/font/google, available as font-serif\n- [x] Inter sans-serif font retained for body text - VERIFIED: layout.tsx loads Inter, set as --font-sans\n- [x] Verdict semantic colors defined (safe/caution/warning/none) - VERIFIED: globals.css defines verdict-safe, verdict-caution, verdict-warning, verdict-none\n- [x] Base body styles set (parchment bg, ink text) - VERIFIED: globals.css body rule applies parchment-50 bg, ink-900 text\n- [x] Build and lint pass clean - VERIFIED: npm run build and npm run lint both pass","notes":"## Implementation Summary\n\n### What was done\n- Configured Tailwind v4 bookish theme in globals.css using @theme inline block\n- Added Libre Baskerville font (400, 700 weights) via next/font/google\n- Created parchment palette (10 shades: cream to deep brown)\n- Created ink palette (10 shades: light to near-black for text)\n- Added verdict semantic colors matching schema enum values\n- Set base body styles (parchment-50 bg, ink-900 text)\n\n### Key decisions\n- Used Tailwind v4 CSS-first @theme config instead of tailwind.config.ts (aligns with Tailwind v4 patterns)\n- Parchment palette is warm/amber-toned to evoke a bookish feel\n- Ink palette is warm-gray (not pure gray) to complement parchment\n- Verdict colors are strong and accessible: green/amber/red/gray\n\n### Files modified\n- src/app/globals.css (modified — added full theme)\n- src/app/layout.tsx (modified — added Libre Baskerville font)\n\n### Caveats\n- No dark mode support yet — can be added later if needed\n- Components should use font-serif for headings, font-sans (default) for body text","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-27T15:40:59.519434-05:00","updated_at":"2026-01-27T16:00:13.332521-05:00","closed_at":"2026-01-27T16:00:13.332521-05:00","close_reason":"Closed"}
{"id":"SafeReads-zve","title":"Build notes and search history pages","description":"- type: task","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-27T15:45:03.966176-05:00","updated_at":"2026-01-27T15:45:03.966176-05:00"}
